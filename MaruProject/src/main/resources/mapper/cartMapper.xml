<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ezen.maru.pjt.cart">
  <!-- 카트테이블과 멤버테이블 조인해서 멤버아이디 일치하는 카트 목록 가져오기 -->
  <select id="getCartList" resultType="cartVo">
    select * from cart order by cart_idx desc
  </select>

  <!-- ================================================= -->
  <update id="addCart" parameterType="cartVo">
    MERGE INTO product_cart
    USING DUAL
    ON (member_idx = #{member_idx} and product_idx = #{product_idx})
    WHEN MATCHED THEN
    UPDATE SET cart_product_number = cart_product_number + #{cart_product_number}
    WHEN NOT MATCHED THEN
    INSERT (member_idx, product_idx, cart_product_number)
    VALUES (#{member_idx}, #{product_idx}, #{cart_product_number})
  </update>

  <insert id="back_addCart" parameterType="cartVo">
    insert into product_cart (
    member_idx, product_idx, cart_product_number
    ) values (
    #{member_idx}, #{product_idx}, #{cart_product_number}
    )
  </insert>
  <update id="updateCart" parameterType="cartVo">
    UPDATE cart
    SET
    cart_name = #{cart_name},
    cart_price = #{cart_price},
    cart_sale = #{cart_sale},
    cart_sale_percent = #{cart_sale_percent},
    cart_size = #{cart_size},
    cart_inventory = #{cart_inventory},
    cart_major_category = #{cart_major_category},

    cart_detail = #{cart_detail}
    WHERE
    cart_idx = #{cart_idx}
  </update>

  <delete id="cartDelete" parameterType="int">
    delete from cart
    where cart_idx = #{cart_idx}
  </delete>
</mapper>	